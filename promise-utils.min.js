/*! promise-utils - v0.0.2 - 2013-06-05
* Copyright (c) 2013 Doug Martin; Licensed MIT */
(function(){"use strict";function n(n,t,e,r){function u(n,t){return t=t||0,C.call(n,t)}function i(n,t,e,u,i,o){return function(){return G(r.map(e.slice(i,o+i),function(r,u){var o=new T;try{G(n.apply(t||e,[r,u+i,e])).then(o.callback,o.errback)}catch(c){o.errback(c)}return o}))}}function o(n,t,e,r){return K(e)&&(r=e,e=null),G(n).then(function(n){var u=O(n)?n:[n];r=r||u.length;for(var o=[],c=0,a=0,l=u.length;l>c;c+=r,a++)o.push(i(t,e,u,a,c,r));return H(o).then(function(t){return{loopResults:st(t)||[],arr:n}},function(n){throw n=ft(n),1===n.length?n[0]:n})})}function c(n){return O(n)?n:J(n)?[n]:n}function a(n,t,e,r){return o(n,t,e,r).then(function(n){return n.arr})}function l(n,t,e,r){return o(n,t,e,r).then(function(n){return n.loopResults})}function f(n,t,e,u){return o(n,t,e,u).then(function(n){var t=n.loopResults,e=n.arr;return r.filter(O(e)?e:[e],function(n,e){return t[e]})})}function p(n,t,e,u){return o(n,t,e,u).then(function(n){return r.every(n.loopResults,function(n){return!!n})})}function s(n,t,e,u){return o(n,t,e,u).then(function(n){return r.some(n.loopResults,function(n){return!!n})})}function h(){return G.apply(null,u(arguments)).then(function(n){return rt.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function m(n){return G(n).then(function(n){return W.call(r,c(n))})}function d(){return G.apply(null,u(arguments)).then(function(n){return lt.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function y(n){return G(n).then(function(n){return ft.call(r,c(n))})}function v(){return G.apply(null,u(arguments)).then(function(n){return _.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function g(){return G.apply(null,u(arguments)).then(function(n){return st.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function x(){return G.apply(null,u(arguments)).then(function(n){return ct.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function b(){var n=u(arguments),t=n.pop(),e=null;return Q(t)||M(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return Z.call(r,c(n),e)})}function k(){var n=u(arguments),t=n.pop(),e=null;return Q(t)||M(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return Y.call(r,c(n),e)})}function q(){var n=u(arguments),t=n.pop(),e=null;return Q(t)||M(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return X.call(r,c(n),e)})}function w(){var n=u(arguments),t=n.pop(),e=null;return K(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return pt.call(r,c(n),e)})}function E(){var n=u(arguments),t=n.pop(),e=null;return K(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return et.call(r,c(n),e)})}function R(n){return G(n).then(function(n){return at.call(r,c(n))})}function A(n){return G(n).then(function(n){return nt.call(r,c(n))})}function j(){var n=u(arguments),t=n.pop(),e=null;return K(t)?e=t:n.push(t),G.apply(null,n).then(function(n){return tt.call(r,c(n),e)})}function D(n){return G(n).then(function(n){return V.call(r,c(n))})}function S(n){return G(n).then(function(n){return ut.call(r,c(n))})}function z(){return G.apply(null,u(arguments)).then(function(n){return ot.apply(r,r.map(c(n),function(n){return O(n)?n:[n]}))})}function P(){return A.apply(null,arguments)}function F(n){var t=u(arguments,1);return G(n).then(function(n){return G(it.apply(r,[c(n)].concat(t)))})}function L(n,t){return G(n).then(function(n){var e=t.split(".");return n=c(n),dt(e).async().forEach(function(t){var e=t.match(/(\w+)\(\)$/);return dt(n).async().map(function(n){return e?n[e[1]]():n[t]},1).then(function(t){n=t})},1).then(function(){return n})})}function N(n){var t=u(arguments,1);return G(n).then(function(n){return G(ht.apply(r,[c(n)].concat(t)))})}function U(n,t){return G(n).then(function(n){return n[t]})}function $(n,t,e){var r=2>arguments.length;return G(n).then(function(n){n=O(n)?n:[n];var u=-1;return r&&(e=n[++u]),I(n.map(function(n,r,u){return 0===r?function(){return t.apply(void 0,[e,n,r,u])}:function(e){return t.apply(void 0,[e,n,r,u])}})).then(function(n){return n})})}function B(n,t,e){var r=2>arguments.length;return G(n).then(function(n){n=O(n)?n:[n];var u=-1,i=n.length;return r&&(e=n[++u]),I(n.slice().reverse().map(function(r,u){return 0===u?function(){return t.apply(void 0,[e,r,i-(u+1),n])}:function(e){return t.apply(void 0,[e,r,i-(u+1),n])}})).then(function(n){return n})})}var C=Array.prototype.slice,G=t.when,H=t.serial,I=t.chain,J=e.isDefined,K=e.isNumber,M=e.isString,O=e.isArray,Q=e.isFunction,T=t.Promise,V=r.sum,W=r.avg,X=r.sort,Y=r.min,Z=r.max,_=r.difference,nt=r.removeDuplicates,tt=r.rotate,et=r.permutations,rt=r.zip,ut=r.transpose,it=r.valuesAt,ot=r.union,ct=r.intersect,at=r.powerSet,lt=r.cartesian,ft=r.compact,pt=r.multiply,st=r.flatten,ht=r.invoke,mt={forEach:a,map:l,filter:f,every:p,some:s,zip:h,sum:D,avg:m,sort:q,min:k,max:b,difference:v,removeDuplicates:A,unique:P,rotate:j,permutations:E,transpose:S,valuesAt:F,union:z,intersect:x,powerSet:R,cartesian:d,compact:y,multiply:w,flatten:g,pluck:L,invoke:N,at:U,reduce:$,reduceRight:B,then:function(n,t,e){return n.then(t,e)},both:function(n,t){return n.both(t)},promise:function(n){return n.promise()},async:function(n){return n}},dt=n.define(O,{async:function(n){return t.resolve(n)}}).define(t.isPromiseLike,mt).expose(mt);return dt}"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(module.exports=n(require("extended"),require("promise-extended"),require("is-extended"),require("array-extended"),require("object-extended"))):"function"==typeof define&&define.amd?define(["extended","promise-extended","is-extended","array-extended","object-extended"],function(t,e,r,u,i){return n(t,e,r,u,i)}):this.promiseUtils=n(this.extended,this.promiseExtended,this.isExtended,this.arrayExtended,this.objectExtended)}).call(this);