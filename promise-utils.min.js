/*! promise-utils - v0.0.3 - 2013-06-06
* Copyright (c) 2013 Doug Martin; Licensed MIT */
!function(){"use strict";function a(a,b,c,d,e){function f(a,b,c,e,f,g){return function(){return M(d.map(c.slice(f,g+f),function(d,e){var g=new U;try{M(a.apply(b||c,[d,e+f,c])).then(g.callback,g.errback)}catch(h){g.errback(h)}return g}))}}function g(a,b,c,d){return Q(c)&&(d=c,c=null),M(a).then(function(a){var e=S(a)?a:[a];d=d||e.length;for(var g=[],h=0,i=0,j=e.length;j>h;h+=d,i++)g.push(f(b,c,e,i,h,d));return N(g).then(function(b){return{loopResults:lb(b)||[],arr:a}},function(a){throw a=jb(a),1===a.length?a[0]:a})})}function h(a){return S(a)?a:P(a)?[a]:a}function i(a,b,c,d){return g(a,b,c,d).then(function(a){return a.arr})}function j(a,b,c,d){return g(a,b,c,d).then(function(a){return a.loopResults})}function k(a,b,c,e){return g(a,b,c,e).then(function(a){var b=a.loopResults,c=a.arr;return d.filter(S(c)?c:[c],function(a,c){return b[c]})})}function l(a,b,c,e){return g(a,b,c,e).then(function(a){return d.every(a.loopResults,function(a){return!!a})})}function m(a,b,c,e){return g(a,b,c,e).then(function(a){return d.some(a.loopResults,function(a){return!!a})})}function n(){return M.apply(null,nb(arguments)).then(function(a){return cb.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function o(a){return M(a).then(function(a){return W.call(d,h(a))})}function p(){return M.apply(null,nb(arguments)).then(function(a){return ib.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function q(a){return M(a).then(function(a){return jb.call(d,h(a))})}function r(){return M.apply(null,nb(arguments)).then(function(a){return $.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function s(){return M.apply(null,nb(arguments)).then(function(a){return lb.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function t(){return M.apply(null,nb(arguments)).then(function(a){return gb.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function u(){var a=nb(arguments),b=a.pop(),c=null;return T(b)||R(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return Z.call(d,h(a),c)})}function v(){var a=nb(arguments),b=a.pop(),c=null;return T(b)||R(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return Y.call(d,h(a),c)})}function w(){var a=nb(arguments),b=a.pop(),c=null;return T(b)||R(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return X.call(d,h(a),c)})}function x(){var a=nb(arguments),b=a.pop(),c=null;return Q(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return kb.call(d,h(a),c)})}function y(){var a=nb(arguments),b=a.pop(),c=null;return Q(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return bb.call(d,h(a),c)})}function z(a){return M(a).then(function(a){return hb.call(d,h(a))})}function A(a){return M(a).then(function(a){return _.call(d,h(a))})}function B(){var a=nb(arguments),b=a.pop(),c=null;return Q(b)?c=b:a.push(b),M.apply(null,a).then(function(a){return ab.call(d,h(a),c)})}function C(a){return M(a).then(function(a){return V.call(d,h(a))})}function D(a){return M(a).then(function(a){return db.call(d,h(a))})}function E(){return M.apply(null,nb(arguments)).then(function(a){return fb.apply(d,d.map(h(a),function(a){return S(a)?a:[a]}))})}function F(){return A.apply(null,arguments)}function G(a){var b=nb(arguments,1);return M(a).then(function(a){return M(eb.apply(d,[h(a)].concat(b)))})}function H(a,b){return M(a).then(function(a){var c=b.split(".");return a=h(a),pb(c).async().forEach(function(b){var c=b.match(/(\w+)\(\)$/);return pb(a).async().map(function(a){return c?a[c[1]]():a[b]},1).then(function(b){a=b})},1).then(function(){return a})})}function I(a){var b=nb(arguments,1);return M(a).then(function(a){return M(mb.apply(d,[h(a)].concat(b)))})}function J(a,b){return M(a).then(function(a){return a[b]})}function K(a,b,c){var d=arguments.length<2;return M(a).then(function(a){a=S(a)?a:[a];var e=-1;return d&&(c=a[++e]),O(a.map(function(a,d,e){return 0===d?function(){return b.apply(void 0,[c,a,d,e])}:function(c){return b.apply(void 0,[c,a,d,e])}})).then(function(a){return a})})}function L(a,b,c){var d=arguments.length<2;return M(a).then(function(a){a=S(a)?a:[a];var e=-1,f=a.length;return d&&(c=a[++e]),O(a.slice().reverse().map(function(d,e){return 0===e?function(){return b.apply(void 0,[c,d,f-(e+1),a])}:function(c){return b.apply(void 0,[c,d,f-(e+1),a])}})).then(function(a){return a})})}var M=b.when,N=b.serial,O=b.chain,P=c.isDefined,Q=c.isNumber,R=c.isString,S=c.isArray,T=c.isFunction,U=b.Promise,V=d.sum,W=d.avg,X=d.sort,Y=d.min,Z=d.max,$=d.difference,_=d.removeDuplicates,ab=d.rotate,bb=d.permutations,cb=d.zip,db=d.transpose,eb=d.valuesAt,fb=d.union,gb=d.intersect,hb=d.powerSet,ib=d.cartesian,jb=d.compact,kb=d.multiply,lb=d.flatten,mb=d.invoke,nb=e.argsToArray,ob={forEach:i,map:j,filter:k,every:l,some:m,zip:n,sum:C,avg:o,sort:w,min:v,max:u,difference:r,removeDuplicates:A,unique:F,rotate:B,permutations:y,transpose:D,valuesAt:G,union:E,intersect:t,powerSet:z,cartesian:p,compact:q,multiply:x,flatten:s,pluck:H,invoke:I,at:J,reduce:K,reduceRight:L,then:function(a,b,c){return a.then(b,c)},both:function(a,b){return a.both(b)},promise:function(a){return a.promise()},async:function(a){return a}},pb=a.define(S,{async:function(a){return b.resolve(a)}}).define(b.isPromiseLike,ob).expose(ob);return pb}"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(module.exports=a(require("extended"),require("promise-extended"),require("is-extended"),require("array-extended"),require("arguments-extended"))):"function"==typeof define&&define.amd?define(["extended","promise-extended","is-extended","array-extended","arguments-extended"],function(b,c,d,e,f){return a(b,c,d,e,f)}):this.promiseUtils=a(this.extended,this.promiseExtended,this.isExtended,this.arrayExtended,this.argumentsExtended)}.call(this);